<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Manual · Libwebsockets.jl</title><meta name="title" content="Manual · Libwebsockets.jl"/><meta property="og:title" content="Manual · Libwebsockets.jl"/><meta property="twitter:title" content="Manual · Libwebsockets.jl"/><meta name="description" content="Documentation for Libwebsockets.jl."/><meta property="og:description" content="Documentation for Libwebsockets.jl."/><meta property="twitter:description" content="Documentation for Libwebsockets.jl."/><meta property="og:url" content="https://bhftbootcamp.github.io/Libwebsockets.jl/pages/manual/"/><meta property="twitter:url" content="https://bhftbootcamp.github.io/Libwebsockets.jl/pages/manual/"/><link rel="canonical" href="https://bhftbootcamp.github.io/Libwebsockets.jl/pages/manual/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Libwebsockets.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li class="is-active"><a class="tocitem" href>Manual</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Manual</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Manual</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/bhftbootcamp/Libwebsockets.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/bhftbootcamp/Libwebsockets.jl/blob/master/docs/src/pages/manual.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="WebSocket-Client-Example"><a class="docs-heading-anchor" href="#WebSocket-Client-Example">WebSocket Client Example</a><a id="WebSocket-Client-Example-1"></a><a class="docs-heading-anchor-permalink" href="#WebSocket-Client-Example" title="Permalink"></a></h1><p>Here we demonstrate how to create a WebSocket client using <strong>Libwebsockets</strong> in Julia. The client connects to data stream and receives updates for a specified trading pair. A callback function processes each incoming message, making it easy to handle data as it arrives. The client is configured with SSL support for secure communication, and you can customize the handler function to suit your data-processing needs.</p><ul><li>Firstly we need to define User Data Structure:</li></ul><p><code>UserData</code> is a struct holding a function <code>callback</code>, which will process the incoming WebSocket messages.</p><pre><code class="language-julia hljs">using Libwebsockets

mutable struct UserData
    callback::Function
end</code></pre><ul><li>Then we define WebSocket Callback Function:</li></ul><p><code>ws_callback</code> is a function that gets triggered on various WebSocket events and calls the user-defined function <code>callback</code> on the message data.</p><pre><code class="language-julia hljs">function ws_callback(wsi::Ptr{Cvoid}, reason::Cint, user::Ptr{Cvoid}, data::Ptr{Cvoid}, len::Csize_t)
    if reason == LWS_CALLBACK_CLIENT_RECEIVE &amp;&amp; data != C_NULL
        ctx = lws_get_context(wsi)
        user_ctx = unsafe_pointer_to_objref(lws_context_user(ctx))
        user_ctx.callback(unsafe_wrap(Vector{UInt8}, Ptr{UInt8}(data), len))
    end
    return lws_callback_http_dummy(wsi, reason, user, data, len)
end</code></pre><p>Now we can define main <code>ws_open</code> function to open and initialize WebSocket connection.  It is possible to set the log level using the <code>lws_set_log_level</code> function; in this example, logging is disabled. The <code>ws_open</code> function consists of three main steps:</p><ul><li>Setup WebSocket Protocol and Callback:</li></ul><p>It defines a WebSocket callback function <code>ws_callback</code> that handles incoming WebSocket events. A <code>protocol</code> structure is created to specify which function should be used for WebSocket events. User data is also set up, containing the callback function the user wants to use to process incoming messages.</p><ul><li>Configure and Create WebSocket Context:</li></ul><p><code>LwsContextCreationInfo</code> is initialized with options for SSL and non-listening mode (indicating this is a client). This configuration is passed to <code>lws_create_context</code>, which creates the WebSocket context needed to manage the connection.</p><ul><li>Establish the WebSocket Connection and Event Loop:</li></ul><p><code>LwsClientConnectInfo</code> is set up with server details like the <code>address</code>, <code>port</code>, <code>path</code>, <code>user</code>, and SSL options, and the connection is initiated using <code>lws_client_connect_via_info</code>. The function then enters an infinite loop, continuously calling <code>lws_service</code> to handle WebSocket events (such as receiving messages) and process them via the user-defined callback.</p><pre><code class="language-julia hljs">function ws_open(callback::Function, addr::String, port::Int, path::String)
    lws_set_log_level(0, C_NULL)
    
    callback_ptr = @cfunction(ws_callback, Cint, (Ptr{Cvoid}, Cint, Ptr{Cvoid}, Ptr{Cvoid}, Csize_t))
    protocols = [
        LwsProtocols(pointer(&quot;ws&quot;), callback_ptr, 0, 0, 0, C_NULL, 0),
        LwsProtocols(C_NULL, C_NULL, 0, 0, 0, C_NULL, 0)
    ]
    user = UserData(callback)

    ctx_info = LwsContextCreationInfo()
    ctx_info.options = LWS_SERVER_OPTION_DO_SSL_GLOBAL_INIT
    ctx_info.port = CONTEXT_PORT_NO_LISTEN
    ctx_info.user = Base.unsafe_convert(Ptr{UserData}, Ref(user))
    ctx_info.protocols = pointer(protocols)
    ws_ctx = lws_create_context(Ref(ctx_info))

    conn_info = LwsClientConnectInfo()
    conn_info.context = ws_ctx
    conn_info.port = port
    conn_info.address = pointer(addr)
    conn_info.path = pointer(path)
    conn_info.host = conn_info.address
    conn_info.ssl_connection = LCCSCF_USE_SSL | LCCSCF_ALLOW_SELFSIGNED
    lws_client_connect_via_info(Ref(conn_info))

    while true
        lws_service(ws_ctx, 0)
    end
end</code></pre><ul><li>User-defined Callback:</li></ul><p>Finally <code>ws_open</code> is called with a user-defined callback function that simply prints any received messages.</p><pre><code class="language-julia hljs">ws_open(&quot;stream.binance.com&quot;, 9443, &quot;/stream?streams=adausdt@depth5@100ms&quot;) do message
    println(&quot;Received message: &quot;, String(message))
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 17 January 2025 15:46">Friday 17 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
